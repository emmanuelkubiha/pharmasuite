<?php
    session_start();
    require_once("connexion.php");

    $_GET['page'] = 4;

    $mc = "";

    if(isset($_POST['fac']))
    {
        $mc = htmlspecialchars(trim(addslashes($_POST['fac'])));
    }

    $id_utilisateur = $_SESSION['ID'];
	
    $req = "select * from UTILISATEUR where ID_UTILISATEUR = $id_utilisateur ";
    $rs = mysqli_query($connexion, $req);
    
    $ET = mysqli_fetch_assoc($rs);
?>
<!doctype html>

<html lang="FR">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title><?php echo $ET100['TITRE']?> - Vente</title>
    <!-- CSS files -->
    <link href="./dist/css/tabler.min.css" rel="stylesheet"/>
    <link href="./dist/css/tabler-flags.min.css" rel="stylesheet"/>
    <link href="./dist/css/tabler-payments.min.css" rel="stylesheet"/>
    <link href="./dist/css/tabler-vendors.min.css" rel="stylesheet"/>
    <link href="./dist/css/demo.min.css" rel="stylesheet"/>
  </head>
  <style>
    .swal2-input[type=number] {
        max-width: 24em !important;
    }
    .nom{
      text-align: center;
      font-weight: bold;
      font-size: 25px;
    }
    
    .tableau{
      width: 60%;
    }
    
    .tableau td{
      text-align: left;
    }

    .table-responsive {
        margin-bottom: 0rem !important;
    }

    .badge1{
      font-size: 1.2rem !important;
      text-transform: lowercase !important;
      height: 2.25rem !important;
      border-radius: 4px;
      padding: calc(.25rem - 1px) .25rem;
      font-weight: 600;
    }

    .bg-purple-lt {
        color: #0953ab!important;
        background: rgb(20 2 25 / 10%)!important;
    }
    
    .row-cards1 {
        --tblr-gutter-x: 0rem !important;
        --tblr-gutter-y: 0rem !important;
    }

    .dropdown-item {
    min-width: 6rem;
    display: flex;
    align-items: center;
    margin: 0;
    line-height: 1.4285714;
}
  </style>
  <body class="antialiased">
    <div class="wrapper">
      <?php include('header.php'); ?>
      <div class="page-wrapper">
        <div class="container-xl">
          <!-- Page title -->
          <div class="page-header d-print-none">
            <div class="row align-items-center">
              <div class="col">
                <h2 class="page-title">
                  Ventes
                </h2>
              </div>
              <!-- Page title actions -->
              <div class="col-auto ms-auto d-print-none">
                <div class="btn-list">
                  <a href="#liste_vente" class="btn btn-primary d-none d-sm-inline-block">
                    <!-- Download SVG icon from http://tabler-icons.io/i/arrow-bar-down -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="12" y1="20" x2="12" y2="10" /><line x1="12" y1="20" x2="16" y2="16" /><line x1="12" y1="20" x2="8" y2="16" /><line x1="4" y1="4" x2="20" y2="4" /></svg>
                    Aller aux ventes
                  </a>
                  <a href="#!" class="btn btn-primary d-none d-sm-inline-block" data-bs-toggle="modal" data-bs-target="#modal-qr-code">
                    <!-- Download SVG icon from http://tabler-icons.io/i/qrcode -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="6" height="6" rx="1" /><line x1="7" y1="17" x2="7" y2="17.01" /><rect x="14" y="4" width="6" height="6" rx="1" /><line x1="7" y1="7" x2="7" y2="7.01" /><rect x="4" y="14" width="6" height="6" rx="1" /><line x1="17" y1="7" x2="17" y2="7.01" /><line x1="14" y1="14" x2="17" y2="14" /><line x1="20" y1="14" x2="20" y2="14.01" /><line x1="14" y1="14" x2="14" y2="17" /><line x1="14" y1="20" x2="17" y2="20" /><line x1="17" y1="17" x2="20" y2="17" /><line x1="20" y1="17" x2="20" y2="20" /></svg>
                    Scanner
                  </a>
                  <a href="#liste_vente" class="btn btn-primary d-sm-none btn-icon" aria-label="Aller aux ventes">
                  <!-- Download SVG icon from http://tabler-icons.io/i/arrow-bar-down -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="12" y1="20" x2="12" y2="10" /><line x1="12" y1="20" x2="16" y2="16" /><line x1="12" y1="20" x2="8" y2="16" /><line x1="4" y1="4" x2="20" y2="4" /></svg>
                  </a>
                  <a href="#!" class="btn btn-primary d-sm-none btn-icon" aria-label="Scanner" data-bs-toggle="modal" data-bs-target="#modal-qr-code">
                  <!-- Download SVG icon from http://tabler-icons.io/i/qrcode -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="6" height="6" rx="1" /><line x1="7" y1="17" x2="7" y2="17.01" /><rect x="14" y="4" width="6" height="6" rx="1" /><line x1="7" y1="7" x2="7" y2="7.01" /><rect x="4" y="14" width="6" height="6" rx="1" /><line x1="17" y1="7" x2="17" y2="7.01" /><line x1="14" y1="14" x2="17" y2="14" /><line x1="20" y1="14" x2="20" y2="14.01" /><line x1="14" y1="14" x2="14" y2="17" /><line x1="14" y1="20" x2="17" y2="20" /><line x1="17" y1="17" x2="20" y2="17" /><line x1="20" y1="17" x2="20" y2="20" /></svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="page-body">
          <div class="container-xl">
            <div class="row row-deck row-cards">

              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">Liste des produits</h3>
                  </div>
                  <div class="table-responsive container-xl" style="max-height: calc(24rem + 10px)">
                    <div class="row row-cards card-body-scrollable card-body-scrollable-shadow">
                      
                    <?php
                        $i = 1;
                        $req = "select count(*) as nombre from PRODUIT ";
                        $rs200 = mysqli_query($connexion,$req);
                        $ET200=mysqli_fetch_assoc($rs200);

                        $req = "select * from PRODUIT where TITRE_PRODUIT like '%$mc%' order by ID_PRODUIT ";
                        $rs20 = mysqli_query($connexion,$req);
                        while($ET20=mysqli_fetch_assoc($rs20)){
                    ?>
                      <div class="col-md-6 col-lg-3 mt-4">
                        <div class="card">
                          <div class="card-body p-4 text-center">
                          <a href="#!" href1="voir_produit.php?id_produit=<?php echo $ET20['ID_PRODUIT']?>" class="btn_voir">
                            <span class="avatar avatar-xl mb-3 avatar-rounded"><?php echo strtoupper(substr($ET20['TITRE_PRODUIT'], 0,2)) ?></span>
                            </a>
                            <h3 class="m-0 mb-1"><a href="#"><?php echo $ET20['TITRE_PRODUIT'] ?></a></h3>
                            <div class="mt-1 mb-1"><span class="badge1 badge-sm bg-purple-lt"><?php echo $ET20['PRIX_VENTE_PRODUIT'] ?> $</span></div>
                            <div class="text-muted">Quantité <?php echo $ET20['QUANTITE_PRODUIT'] ?></div>
                          </div>
                          <div class="d-flex">
                            <a class="dropdown-item card-btn text-dark bg-green-lt btn-primary btn_vente" href="#!" href1="./dist/traitement/ventescript.php?id_produit=<?php echo $ET20['ID_PRODUIT']?>&prix_vente=<?php echo $ET20['PRIX_VENTE_PRODUIT'] ?>&prix_achat=<?php echo $ET20['PRIX_ACHAT_PRODUIT'] ?>&stock=<?php echo $ET20['QUANTITE_PRODUIT'] ?>" prix_unitaire="<?php echo $ET20['PRIX_VENTE_PRODUIT'] ?>" data="<?php echo $ET20['QUANTITE_PRODUIT'] ?>"><!-- Download SVG icon from http://tabler-icons.io/i/shopping-cart -->
	                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="6" cy="19" r="2" /><circle cx="17" cy="19" r="2" /><path d="M17 17h-11v-14h-2" /><path d="M6 5l14 1l-1 7h-13" /></svg>
                              Vendre
                            </a>
                          </div>
                        </div>
                      </div>

                      <?php } ?>
                      
                    </div>
                  </div>
                    <div class="card-footer d-flex align-items-center">
                      <p class="m-0 text-muted">Total : <span><?php echo $ET200['nombre'] ?></span> produit<?php if($ET200['nombre'] >1) echo 's';?></p>
                    </div>
                </div>
              </div>
              <div class="page-body" id="liste_vente">
                <div class="container-xl row-cards1">
                  <div class="row row-cards">
                  <div class="col-12">
                      <div class="card">
                        <div class="card-header">
                          <h3 class="card-title">Liste des ventes</h3>
                        </div>
                        <form action="facture.php?page=4" method="POST">
                        <div class="table-responsive" style="height: calc(24rem + 10px)">
                          <table class="table card-table table-vcenter text-nowrap datatable card-body-scrollable card-body-scrollable-shadow">
                            <thead>
                              <tr>
                                <th class="w-1"></th>
                                <th class="w-1">No. <!-- Download SVG icon from http://tabler-icons.io/i/chevron-up -->
                                </th>
                                <th>Nom</th>
                                <!-- <th>Age</th> -->
                                <th class="text-center">Quantité</th>
                                <th class="text-center">P.U</th>
                                <th class="text-center">P.T</th>
                                <!-- <th>Bloc</th> -->
                                <th class="text-center">Date et heure vente</th>
                                <th></th>
                              </tr>
                            </thead>
                            <tbody>
                            <?php
                                $i = 1;
                                $montant = 0;
                                $reste = 0;

                                $req = "select count(*) as nombre from VENTE ";
                                $rs200 = mysqli_query($connexion,$req);
                                $ET200=mysqli_fetch_assoc($rs200);

                                $req = "select * from VENTE order by ID_VENTE desc";
                                $rs201 = mysqli_query($connexion,$req);
                                while($ET201=mysqli_fetch_assoc($rs201)){

                                    $id_produit = $ET201['ID_PRODUIT'];

                                $req = "select * from PRODUIT where ID_PRODUIT = $id_produit ";
                                $rs20 = mysqli_query($connexion,$req);
                                if($ET20=mysqli_fetch_assoc($rs20)){
                            ?>
                              <tr>

                                <td><input class="form-check-input m-0 align-middle" type="checkbox" value="<?php echo $ET201['ID_VENTE'] ?>" name="facture[]" aria-label="Select invoice"></td>
                                <td><span class="text-muted">00<?php echo $i++ ?></span></td>
                                <td><a href="#!" class="text-reset" tabindex="-1"><?php echo $ET20['TITRE_PRODUIT'] ?></a></td>
                                <td class="text-center"><?php echo $ET201['QUANTITE_VENTE'] ?></td>
                                <td class="text-center"><?php echo $ET201['PRIX_VENTE'] ?> $</td>
                                <td class="text-center"><?php echo ($ET201['QUANTITE_VENTE'] * $ET201['PRIX_VENTE']) ?> $</td>
                                <td class="text-center">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2" /><line x1="16" y1="3" x2="16" y2="7" /><line x1="8" y1="3" x2="8" y2="7" /><line x1="4" y1="11" x2="20" y2="11" /><line x1="11" y1="15" x2="12" y2="15" /><line x1="12" y1="15" x2="12" y2="18" /></svg>
                                  <?php echo 'Le '.date("d/m/Y à h:m:s", strtotime($ET201['DATE_VENTE'])) ?>
                                </td>
                                <td class="text-end">
                                  <span class="dropdown">
                                    <button class="btn dropdown-toggle align-text-top" data-bs-boundary="viewport" data-bs-toggle="dropdown">Actions</button>
                                    <div class="dropdown-menu dropdown-menu-end">
                                        <a class="dropdown-item btn_modifier" href="./dist/traitement/annuler_vente.php?id_vente=<?php echo $ET201['ID_VENTE']?>&id_produit=<?php echo $ET20['ID_PRODUIT']?>&stock=<?php echo $ET20['QUANTITE_PRODUIT'] ?>&quantite=<?php echo $ET201['QUANTITE_VENTE'] ?>&prix_vente=<?php echo $ET201['PRIX_VENTE'] ?>">
                                          Annuler cette vente
                                        </a>
                                        <?php if($_SESSION['NIVEAU'] == 1){ ?>
                                        <a class="dropdown-item supprimer" href="./dist/traitement/supprimer_vente.php?id_vente=<?php echo $ET201['ID_VENTE']?>">
                                          Supprimer
                                        </a>
                                        <?php } ?>
                                    </div>
                                  </span>
                                </td>

                              </tr>
                              <?php
                                $montant += ($ET201['QUANTITE_VENTE'] * $ET201['PRIX_VENTE']);
                                }}
                             ?>
                            </tbody>
                          </table>
                        </div>
                        <div class="card-footer d-flex align-items-center">
                          <p class="m-0 text-muted">Total : <span><?php echo $ET200['nombre'] ?></span> vente<?php if($ET200['nombre'] >1) echo 's';?> et <?php echo $montant ?> $ </p>
                          <ul class="pagination m-0 ms-auto">
                            <li class=""><!-- Download SVG icon from http://tabler-icons.io/i/clipboard-list -->
	                            <button type="submit" class="btn btn-primary">
                              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2" /><rect x="9" y="3" width="6" height="4" rx="2" /><line x1="9" y1="12" x2="9.01" y2="12" /><line x1="13" y1="12" x2="15" y2="12" /><line x1="9" y1="16" x2="9.01" y2="16" /><line x1="13" y1="16" x2="15" y2="16" /></svg>
                              Facture
                              </button>
                            </li>
                          </ul>
                        </div>
                        </form>
                      </div>
                    </div>

    <div class="modal modal-blur fade" id="modal-qr-code" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          <div class="modal-body mb-4">
            <div class="modal-body text-center py-2"><!-- Download SVG icon from http://tabler-icons.io/i/barcode -->
              <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-primary icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7v-1a2 2 0 0 1 2 -2h2" /><path d="M4 17v1a2 2 0 0 0 2 2h2" /><path d="M16 4h2a2 2 0 0 1 2 2v1" /><path d="M16 20h2a2 2 0 0 0 2 -2v-1" /><rect x="5" y="11" width="1" height="2" /><line x1="10" y1="11" x2="10" y2="13" /><rect x="14" y="11" width="1" height="2" /><line x1="19" y1="11" x2="19" y2="13" /></svg>
            </div>

            <div class="col">
              <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
              <div class="col-sm-12">
                <label class="form-label text-center">Scanner le QR Code du produit :</label>
                <video id="preview" class="p-1 border" style="width:100%; height:300px;"></video>
              </div>
            </div>
            <div class="mt-3 h4 text-center text-success d-none" data-bs-toggle="modal" data-bs-target="#modal-qr-code-image">Scanner une photo</div>

          </div>
        </div>
      </div>
    </div>
    <!-- Libs JS -->
    <script src="./dist/libs/apexcharts/dist/apexcharts.min.js"></script>
    <!-- Tabler Core -->
    <script src="./dist/js/tabler.min.js"></script>

    <script src="./dist/js/jquery-3.2.1.min.js"></script>
    <script src="./dist/js/sweetalert2.all.js"></script>
    <script src="./dist/js/sweetalert2.js"></script>
    <script src="./dist/js/sweetalert2.min.js"></script>
    <script src="./dist/js/sweetalert2.all.min.js"></script>
    <script type="text/javascript" src="./dist/js/qrcode.min.js"></script>
    <script type="text/javascript" src="./dist/js/instascan.min.js"></script>
    <script src="./dist/js/traitement.js"></script>
    <script src="./dist/js/nous.js"></script>
		<script src="./dist/js/easy.qrcode.min.js" type="text/javascript" charset="utf-8"></script>
    <script>
  
  $('.formulaire').on('submit',function(e){
      e.preventDefault();

      var donnees = $(this).serialize();
  
      lien = $(this).attr('action');

      swal.fire({
          html: '<p>Patienter<span class="animated-dots"></span></p>',
          imageUrl: './dist/loader.gif',
          showConfirmButton: false,
          allowOutsideClick: false,
      });

      $.post(lien, donnees, function(response) {
          
          if (response == 1) {

            swal.fire({
                text: "Bien ajouté !",
                icon: "success",
                showConfirmButton: false,
                timer: 2000,
            });

            document.location.reload();
              
          }
          else
          {

            swal.fire({
                text: "Il y a un problème !",
                icon: "warning",
                showConfirmButton: false,
                timer: 4000,
            });

          }
  
      })

  });

        $('.btn_deconnexion').on('click',function(e){
            e.preventDefault();
            swal.fire({
                text: 'Vous voulez vous déconnecter ?',
                icon: "question",
                showConfirmButton: true,
                showCancelButton: true,
                confirmButtonColor: '#3885d6',
                cancelButtonColor:'#d33',
                confirmButtonText: 'Oui',
                cancelButtonText: 'Non',
            }).then((result)=>{
                if(result.value){
                    document.location.href='deconnexion.php';
                }
            })
        })


$('.btn_vente').on('click',function(e){
  e.preventDefault();

  const href = $(this).attr('href1');
  const data = $(this).attr('data');
  const prix_unitaire = $(this).attr('prix_unitaire');

  if(data > 0)
  {
    swal.fire({
      html: 'Entrer la quantité de ce produit',
      input: 'number',
      showConfirmButton: true,
      showCancelButton: true,
      confirmButtonColor: '#3885d6',
      cancelButtonColor:'#d33',
      confirmButtonText: 'Vendre',
      cancelButtonText: 'Annuler',
      closeOnConfirm: true,
      animation: 'slide-from-top',
      inputLabel: 'Entrer une valeur qui est entre 1 et ' + data + ' pour vendre !',
      inputPlaceholder: 'Entrer la quantité ici',
      allowOutsideClick: false,
      inputAttributes: {
        min: 1,
        max: data,
        step: 1
      },
      inputValidator: (value) => {
        if (parseInt(value) > parseInt(data)) {
          return 'Il ne reste que '+ data +' au stock';
        }
        if (parseInt(value) <= 0) {
          return 'Entrer une valeur qui est entre 1 et ' + data;
        }
      }
    }).then((result)=>{
      if(result.value){

        swal.fire({
            html: '<p>Patienter<span class="animated-dots"></span></p>',
            imageUrl: './dist/loader.gif',
            showConfirmButton: false,
            allowOutsideClick: false,
        });

        $.post(href, {'quantite' : result.value}, function() {

            swal.fire({
                text: 'Bien effectué',
                icon: "success",
                showConfirmButton: false,
                timer: 3000,
            });
            document.location.reload();
        })

      }
    })
  } 
  else
  {
    swal.fire({
        text: 'Ce stock est déjà épuisé !',
        icon: "warning",
        showConfirmButton: false,
        timer: 4000,
    })
  }

  
})

        $('.btn_voir').on('click',function(e){
          e.preventDefault();
          const href = $(this).attr('href1');

          $.post(href, {}, function(response) {
            swal.fire({
                html: response,
                showConfirmButton: false,
                showCancelButton: true,
                confirmButtonColor: '#3885d6',
                cancelButtonColor:'#d33',
                cancelButtonText: 'Quitter',
                allowOutsideClick: false,
            })

        })
          
        })

        $('.btn_voir1').on('click',function(e){
          e.preventDefault();
          const href = $(this).attr('lien');

          $.post(href, {}, function(response) {
            swal.fire({
                html: response,
                showConfirmButton: false,
                showCancelButton: true,
                confirmButtonColor: '#3885d6',
                cancelButtonColor:'#d33',
                cancelButtonText: 'Quitter',
                allowOutsideClick: false,
            })

          })
          
        })

$('.supprimer').on('click',function(e){
    e.preventDefault();

    swal.fire({
        text: 'Vous voulez supprimer ?',
        icon: "question",
        showConfirmButton: true,
        showCancelButton: true,
        confirmButtonColor: '#3885d6',
        cancelButtonColor:'#232e3c',
        confirmButtonText: 'Oui',
        cancelButtonText: 'Non',
    }).then((result)=>{
        if(result.value){

        var lien = $(this).attr('href');

        swal.fire({
            html: '<p>Patienter<span class="animated-dots"></span></p>',
            imageUrl: './dist/loader.gif',
            showConfirmButton: false,
            allowOutsideClick: false,
        });

        $.post(lien, function(response) {
            
            if (response == 1){

                swal.fire({
                    text: "Bien supprimée !",
                    icon: "success",
                    showConfirmButton: false,
                    timer: 2000,
                });
                
            }

            document.location.reload();

        })

        }
    })

})

        $('.btn_modifier').on('click',function(e){
            e.preventDefault();
            const href = $(this).attr('href');
            //const data = $(this).attr('data');
            swal.fire({
                text: 'Vous voulez annuler cette vente ?',
                icon: "question",
                showConfirmButton: true,
                showCancelButton: true,
                confirmButtonColor: '#3885d6',
                cancelButtonColor:'#d33',
                confirmButtonText: 'Oui',
                cancelButtonText: 'Non',
            }).then((result)=>{
                if(result.value){

                  swal.fire({
                      html: '<p>Patienter<span class="animated-dots"></span></p>',
                      imageUrl: './dist/loader.gif',
                      showConfirmButton: false,
                      allowOutsideClick: false,
                  });

                  $.get(href, function(response) {
                      
                      if (response == 1){

                          swal.fire({
                              text: "Bien supprimée !",
                              icon: "success",
                              showConfirmButton: false,
                              timer: 2000,
                          });
                          
                      }

                      document.location.reload();

                  })
                }
            })
        })
 

        $('.btn_confirmer').on('click',function(e){
            e.preventDefault();
            const href = $(this).attr('href');
            //const data = $(this).attr('data');
            swal.fire({
                text: 'Vous voulez confirmer la réception de cette réservation ?',
                icon: "question",
                showConfirmButton: true,
                showCancelButton: true,
                confirmButtonColor: '#3885d6',
                cancelButtonColor:'#d33',
                confirmButtonText: 'Oui',
                cancelButtonText: 'Non',
            }).then((result)=>{
                if(result.value){
                    document.location.href=href;
                }
            })
        })

        $('.no_dispo').on('click',function(e){
          e.preventDefault();

          swal.fire({
            html: '<div class="form-label">Vous ne pouvez pas visiter cette option !</div>',
            icon: "info",
            showConfirmButton: false,
            timer: 3000,
          })
        })
        
    </script>
    
    <script type="text/javascript">
  
      $('#qr-code').on('click',function(e){
        e.preventDefault();

          var scanner = new Instascan.Scanner({ video: document.getElementById('preview'), scanPeriod: 5, mirror: false });
          scanner.addListener('scan',function(content){

            var id_produit = parseInt(content);

            const href = "./dist/traitement/voir_produit.php?id_produit=" + id_produit ;

            $.post(href, {}, function(response) {
              swal.fire({
                html: response + '<div class="h3">Entrer la quantité de ce produit</div>',
                input: 'number',
                showConfirmButton: true,
                showCancelButton: true,
                confirmButtonColor: '#3885d6',
                cancelButtonColor:'#d33',
                confirmButtonText: 'Vendre',
                cancelButtonText: 'Annuler',
                closeOnConfirm: true,
                animation: 'slide-from-top',
                inputLabel: 'Entrer une valeur qui est entre 1 et la quantité totale du stock pour vendre !',
                inputPlaceholder: 'Entrer la quantité ici',
                allowOutsideClick: false,
                inputAttributes: {
                  min: 1,
                  step: 1
                }
              }).then((result)=>{
                if(result.value){

                  swal.fire({
                      html: '<p>Patienter<span class="animated-dots"></span></p>',
                      imageUrl: './dist/loader.gif',
                      showConfirmButton: false,
                      allowOutsideClick: false,
                  });

                  $.post(href, {'quantite' : result.value}, function() {

                      swal.fire({
                          text: 'Bien effectué',
                          icon: "success",
                          showConfirmButton: false,
                          timer: 3000,
                      });
                      document.location.reload();
                  })

                }
              })

            })

          });
          Instascan.Camera.getCameras().then(function(cameras){
            if(cameras.length > 0){
              scanner.start(cameras[1]);
            }else{
              swal.fire({
                text: "Aucun caméra trouvé !",
                icon: "warning",
                showConfirmButton: false,
                timer: 4000,
              });
            }
          }).catch(function(e){
            swal.fire({
              text: "Erreur : " + e,
              icon: "warning",
              showConfirmButton: false,
              timer: 4000,
            });
          });
      });
    </script>
  </body>
</html>

<?php if(isset ($_GET['code'])){ 
    if(($_GET['code'])==1){ ?>
    <script>			
        swal.fire({
        text: " Bien effectué !",
        icon: "success",
        showConfirmButton: false,
        timer: 2000,
        });
    </script>
<?php } } ?>

<?php if(isset ($_GET['code'])){ 
    if(($_GET['code'])==0){ ?>
    <script>			
        swal.fire({
        text: " Cette entrée existe déjà !",
        icon: "error",
        showConfirmButton: false,
        timer: 3000,
        });
    </script>
<?php } } ?>

<?php if(isset ($_GET['code'])){ 
    if(($_GET['code'])==3){ ?>
    <script>			
        swal.fire({
        text: " Veuillez sélectionner au moins une entrée !",
        icon: "warning",
        showConfirmButton: false,
        timer: 3000,
        });
    </script>
<?php } } ?>