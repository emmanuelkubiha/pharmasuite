<?php
    session_start();
    require_once("connexion.php");

    $_GET['page'] = 6;

    $mc = "";

    if(isset($_POST['fac']))
    {
        $mc = htmlspecialchars(trim(addslashes($_POST['fac'])));
    }

    $id_utilisateur = $_SESSION['ID'];
	
    $req = "select * from UTILISATEUR where ID_UTILISATEUR = $id_utilisateur ";
    $rs = mysqli_query($connexion, $req);
    
    $ET = mysqli_fetch_assoc($rs);
?>
<!doctype html>

<html lang="FR">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title><?php echo $ET100['TITRE']?> - Notifications</title>
    <!-- CSS files -->
    <link href="./dist/css/tabler.min.css" rel="stylesheet"/>
    <link href="./dist/css/tabler-flags.min.css" rel="stylesheet"/>
    <link href="./dist/css/tabler-payments.min.css" rel="stylesheet"/>
    <link href="./dist/css/tabler-vendors.min.css" rel="stylesheet"/>
    <link href="./dist/css/demo.min.css" rel="stylesheet"/>
  </head>
  <body class="antialiased">
    <div class="wrapper">
      <?php include('header.php'); ?>
      <div class="page-wrapper">
        <div class="container-xl">
          <!-- Page title -->
          <div class="page-header d-print-none">
            <div class="row align-items-center">
              <div class="col">
                <h2 class="page-title">
                  Produits à stock très faible
                </h2>
              </div>
            </div>
          </div>
        </div>
        <div class="page-body">
          <div class="container-xl">
            <div class="row row-cards">
            <?php
                $i = 1;

                $req = "select * from PRODUIT where (QUANTITE_PRODUIT <= SEUIL_PRODUIT) and TITRE_PRODUIT like '%$mc%' order by ID_PRODUIT ";
                $rs20 = mysqli_query($connexion,$req);
                while($ET20=mysqli_fetch_assoc($rs20)){
            ?>
              <div class="col-md-4">
                <div class="card">
                  <ul class="nav nav-tabs" data-bs-toggle="tabs">
                    <li class="nav-item">
                      <a href="#tabs-home-<?php echo $i ?>" class="nav-link active" data-bs-toggle="tab"><!-- Download SVG icon from http://tabler-icons.io/i/alert-triangle -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 9v2m0 4v.01" /><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75" /></svg>
                        Alerte n°0<?php echo $i++ ?></a>
                    </li>
                  </ul>
                  <div class="card-body">
                    <div class="tab-content">
                      <div class="tab-pane active show" id="tabs-home-<?php echo $i ?>">
                        <div class="col-12">
                          <div class="card">
                            <div class="card-body">
                              <div class="card-title">Info Alerte</div>
                              <div class="mb-2">
                                <!-- Download SVG icon from http://tabler-icons.io/i/book -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2 text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" /><path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" /><line x1="3" y1="6" x2="3" y2="19" /><line x1="12" y1="6" x2="12" y2="19" /><line x1="21" y1="6" x2="21" y2="19" /></svg>
                                Nom : <strong><?php echo $ET20['TITRE_PRODUIT'] ?></strong>
                              </div>
                              <div>
                                <!-- Download SVG icon from http://tabler-icons.io/i/clock -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2 text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2" /><line x1="16" y1="3" x2="16" y2="7" /><line x1="8" y1="3" x2="8" y2="7" /><line x1="4" y1="11" x2="20" y2="11" /><line x1="11" y1="15" x2="12" y2="15" /><line x1="12" y1="15" x2="12" y2="18" /></svg>
                                Stock : <strong><?php echo $ET20['QUANTITE_PRODUIT'] ?> <?php //echo $ET30['VENTE_PAR'] ?><?php //if($ET20['STOCK_MEDICAMENT'] > 1) echo 's';?></strong><!-- Download SVG icon from http://tabler-icons.io/i/corner-down-left-double -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 5v6a3 3 0 0 1 -3 3h-7" /><path d="M13 10l-4 4l4 4m-5 -8l-4 4l4 4" /></svg>
                                <div class="badge bg-red spinner-grow text-red" role="status"></div>
                              </div>
                            </div>
                          </div>
                        </div>                      
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <?php } ?>
            </div>
          </div>
        </div>
        
        <?php include('footer.php') ?>
      </div>
    </div>
    <!-- Libs JS -->
    <!-- Tabler Core -->
    <script src="./dist/js/tabler.min.js"></script>

    <script src="./dist/js/jquery-3.2.1.min.js"></script>
    <script src="./dist/js/sweetalert2.all.js"></script>
    <script src="./dist/js/sweetalert2.js"></script>
    <script src="./dist/js/sweetalert2.min.js"></script>
    <script src="./dist/js/sweetalert2.all.min.js"></script>
    <script src="./dist/js/traitement.js"></script>
    <script src="./dist/js/nous.js"></script>
    <script>
  
  $('.formulaire').on('submit',function(e){
      e.preventDefault();

      var donnees = $(this).serialize();
  
      lien = $(this).attr('action');

      swal.fire({
          html: '<p>Patienter<span class="animated-dots"></span></p>',
          imageUrl: './dist/loader.gif',
          showConfirmButton: false,
          allowOutsideClick: false,
      });

      $.post(lien, donnees, function(response) {
          
          if (response == 1) {

            swal.fire({
                text: "Bien ajouté !",
                icon: "success",
                showConfirmButton: false,
                timer: 2000,
            });

            document.location.reload();
              
          }
          else
          {

            swal.fire({
                text: "Il y a un problème !",
                icon: "warning",
                showConfirmButton: false,
                timer: 4000,
            });

          }
  
      })

  });
      $('.btn_deconnexion').on('click',function(e){
          e.preventDefault();
          swal.fire({
              text: 'Vous voulez vous déconnecter ?',
              icon: "question",
              showConfirmButton: true,
              showCancelButton: true,
              confirmButtonColor: '#3885d6',
              cancelButtonColor:'#d33',
              confirmButtonText: 'Oui',
              cancelButtonText: 'Non',
          }).then((result)=>{
              if(result.value){
                  document.location.href='deconnexion.php';
              }
          })
      })
      $('.btn_supprimer').on('click',function(e){
          e.preventDefault();
          const href = $(this).attr('href');
          swal.fire({
              text: 'Vous voulez supprimer ?',
              icon: "question",
              showConfirmButton: true,
              showCancelButton: true,
              confirmButtonColor: '#3885d6',
              cancelButtonColor:'#d33',
              confirmButtonText: 'Oui',
              cancelButtonText: 'Non',
          }).then((result)=>{
              if(result.value){
                  document.location.href=href;
              }
          })
      })

      $('.btn_modifier').on('click',function(e){
          e.preventDefault();
          const href = $(this).attr('href');
          //const data = $(this).attr('data');
          swal.fire({
              text: 'Vous voulez modifier ?',
              icon: "question",
              showConfirmButton: true,
              showCancelButton: true,
              confirmButtonColor: '#3885d6',
              cancelButtonColor:'#d33',
              confirmButtonText: 'Oui',
              cancelButtonText: 'Non',
          }).then((result)=>{
              if(result.value){
                  document.location.href=href;
              }
          })
      })

      $('.no_dispo').on('click',function(e){
        e.preventDefault();

        swal.fire({
          html: '<div class="form-label">Vous ne pouvez pas visiter cette option !</div>',
          icon: "info",
          showConfirmButton: false,
          timer: 3000,
        })
      })
        
    </script>
</body>
</html>

<?php if(isset ($_GET['code'])){ 
if(($_GET['code'])==1){ ?>
<script>			
    swal.fire({
    text: " Bien effectué !",
    icon: "success",
    showConfirmButton: false,
    timer: 2000,
    });
</script>
<?php } } ?>

<?php if(isset ($_GET['code'])){ 
if(($_GET['code'])==0){ ?>
<script>			
    swal.fire({
    text: " Cette entrée existe déjà !",
    icon: "error",
    showConfirmButton: false,
    timer: 3000,
    });
</script>
<?php } } ?>